import{_ as A,u as T,f as r,l as S,A as q,c as u,b as s,a as z,g as y,t as g,m as b,w as K,F as L,r as M,B as w,z as j,o as d,n as x}from"./index-rvQoOiZL.js";import{s as m}from"./errorHandler-QDbb1r-H.js";const H={class:"verification-page"},W={class:"verification-container"},$={class:"verification-card"},J={class:"verification-header"},U={class:"verification-subtitle"},Y={key:0,class:"verification-step"},G={class:"form-actions"},Q=["disabled"],X={key:0,class:"loading-spinner"},Z={key:1,class:"verification-step"},ee={class:"otp-input-group"},te={class:"otp-inputs"},se=["onInput","onKeydown","onFocus","disabled"],ae={key:0,class:"error-message"},oe={class:"form-actions"},ie=["disabled"],ne={key:0,class:"loading-spinner"},re={class:"verification-options"},le={class:"resend-text"},ce=["disabled"],ue={__name:"EmailVerificationView",setup(de){const I=j(),i=T(),V=r(!1),h=r(!1),v=r(!1),_=r(!1),l=r(""),c=r(0),f=r([]),p=r(["","","","","",""]),O=S(()=>{var t;return((t=i.userInfo)==null?void 0:t.email)||"your email"}),k=S(()=>p.value.every(t=>t!=="")),E=async()=>{var t;if(!((t=i.userInfo)!=null&&t.email)){m(new Error("Email not found. Please login again."));return}h.value=!0;try{const e=await w.sendVerificationCode(i.userInfo.email);e.status>=200&&e.status<300?(V.value=!0,C()):m(new Error(e.message||"Failed to send verification code"))}catch(e){m(e)}finally{h.value=!1}},D=async()=>{if(!k.value){l.value="Please enter the complete verification code";return}v.value=!0,l.value="";try{const t=p.value.join(""),e=await w.verifyEmail({email:i.userInfo.email,otp:t});if(e.status>=200&&e.status<300){const a={...i.userInfo,emailVerified:!0};i.userInfo=a,localStorage.setItem("auth_userInfo",JSON.stringify(a)),i.isLawyer()?I.push("/dashboard/lawyer"):I.push("/dashboard/user")}else l.value=e.message||"Invalid verification code"}catch(t){m(t)}finally{v.value=!1}},F=async()=>{if(!(c.value>0)){_.value=!0;try{const t=await w.sendVerificationCode(i.userInfo.email);t.status>=200&&t.status<300?C():m(new Error(t.message||"Failed to resend verification code"))}catch(t){m(t)}finally{_.value=!1}}},P=(t,e)=>{var o;const a=t.target.value;a.length>1&&(t.target.value=a[0]),p.value[e]=a,a&&e<5&&((o=f.value[e+1])==null||o.focus()),l.value=""},B=(t,e)=>{var a;t.key==="Backspace"&&!p.value[e]&&e>0&&((a=f.value[e-1])==null||a.focus())},R=t=>{var a;t.preventDefault();const e=t.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);e.length===6&&(p.value=e.split(""),f.value.forEach((o,n)=>{o&&(o.value=p.value[n])}),(a=f.value[5])==null||a.focus())},N=t=>{var e;(e=f.value[t])==null||e.select()},C=()=>{c.value=60;const t=setInterval(()=>{c.value--,c.value<=0&&clearInterval(t)},1e3)};return q(()=>{var t;i.isLoggedIn&&!((t=i.userInfo)!=null&&t.emailVerified)&&E()}),(t,e)=>(d(),u("div",H,[s("div",W,[s("div",$,[s("div",J,[e[1]||(e[1]=z('<div class="verification-icon" data-v-69eaaead><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-69eaaead><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" data-v-69eaaead></path><polyline points="22,6 12,13 2,6" data-v-69eaaead></polyline></svg></div><h1 class="verification-title" data-v-69eaaead>Verify Your Email</h1>',2)),s("p",U,[e[0]||(e[0]=y(" We've sent a verification code to ")),s("strong",null,g(O.value),1)])]),V.value?(d(),u("div",Z,[e[5]||(e[5]=s("p",{class:"step-description"}," Enter the 6-digit verification code sent to your email address. ",-1)),s("form",{onSubmit:K(D,["prevent"]),class:"verification-form"},[s("div",ee,[e[3]||(e[3]=s("label",{for:"otp",class:"form-label"},"Verification Code",-1)),s("div",te,[(d(),u(L,null,M(6,(a,o)=>s("input",{key:o,ref_for:!0,ref:n=>f.value[o]=n,type:"text",maxlength:"1",class:x(["otp-input",{"otp-input--error":l.value}]),onInput:n=>P(n,o),onKeydown:n=>B(n,o),onPaste:R,onFocus:n=>N(o),disabled:v.value},null,42,se)),64))]),l.value?(d(),u("p",ae,g(l.value),1)):b("",!0)]),s("div",oe,[s("button",{type:"submit",class:"btn btn-primary",disabled:v.value||!k.value},[v.value?(d(),u("span",ne)):b("",!0),y(" "+g(v.value?"Verifying...":"Verify Email"),1)],8,ie)])],32),s("div",re,[s("p",le,[e[4]||(e[4]=y(" Didn't receive the code? ")),s("button",{onClick:F,class:"resend-link",disabled:_.value||c.value>0},g(c.value>0?`Resend in ${c.value}s`:"Resend Code"),9,ce)])])])):(d(),u("div",Y,[e[2]||(e[2]=s("p",{class:"step-description"}," To complete your registration, please verify your email address. We'll send you a 6-digit verification code. ",-1)),s("div",G,[s("button",{onClick:E,class:"btn btn-primary",disabled:h.value},[h.value?(d(),u("span",X)):b("",!0),y(" "+g(h.value?"Sending...":"Send Verification Code"),1)],8,Q)])])),e[6]||(e[6]=s("div",{class:"verification-footer"},[s("p",null,[y(" Having trouble? "),s("a",{href:"#",class:"link"},"Contact Support")])],-1))])])]))}},pe=A(ue,[["__scopeId","data-v-69eaaead"]]);export{pe as default};
