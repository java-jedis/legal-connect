import{_ as ee,V as te,u as oe,f as w,l as u,A as ne,M as se,D as re,c as n,b as t,m as g,g as p,t as i,i as V,v as ae,j as le,s as D,z as ie,o as s}from"./index-rvQoOiZL.js";import{C as ce,a as ue}from"./ChatConversationList-BF17EnVr.js";const de={class:"chat-inbox-view"},ve={class:"container"},we={class:"inbox-header"},he={class:"header-content"},ke={class:"header-title"},ge={class:"header-subtitle"},pe={key:0,class:"unread-indicator"},me={class:"header-actions"},fe=["disabled"],ye={key:0,class:"icon",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Ce={key:1,class:"icon loading-spinner",viewBox:"0 0 24 24"},be=["disabled"],xe={key:0,class:"icon",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},_e={key:1,class:"icon loading-spinner",viewBox:"0 0 24 24"},Me={key:0,class:"connection-status-banner"},Le={class:"search-filters"},Se={class:"search-bar"},Re={class:"filter-controls"},je=["title"],Ne={class:"icon",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Be={key:0,d:"M16 4l4 4-4 4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Te={key:1,d:"M16 20l4-4-4-4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Ae={class:"inbox-content"},Ee={key:0,class:"loading-state"},Ve={key:1,class:"error-state"},De=["disabled"],Ue={key:0,class:"icon loading-spinner",viewBox:"0 0 24 24"},Pe={key:2,class:"empty-state"},Ie={class:"empty-actions"},Fe={key:3,class:"conversations-container"},ze={key:0,class:"pagination"},$e=["disabled"],We={class:"pagination-info"},Oe={class:"page-numbers"},qe={class:"total-count"},Ge=["disabled"],He={__name:"ChatInboxView",setup(Qe){const r=te(),U=oe(),P=ie(),c=w(""),d=w("all"),h=w("desc"),l=w(1),_=w(20),m=w(!1),f=w(!1),b=w(null),R=u(()=>r.sortedConversations),y=u(()=>r.isLoading),k=u(()=>r.error),j=u(()=>r.isConnected),I=u(()=>r.totalUnreadCount),F=u(()=>r.hasUnreadMessages),z=u(()=>k.value?k.value.includes("network")||k.value.includes("timeout")?"Network error. Please check your connection and try again.":k.value.includes("unauthorized")||k.value.includes("403")?"You are not authorized to access conversations.":k.value:"Failed to load conversations"),v=u(()=>{let o=[...R.value];if(c.value.trim()){const e=c.value.toLowerCase().trim();o=o.filter(a=>{const x=W(a).toLowerCase(),S=(a.lastMessage||"").toLowerCase();return x.includes(e)||S.includes(e)})}switch(d.value){case"unread":o=o.filter(e=>r.getConversationUnreadCount(e.id)>0);break;case"recent":{const e=new Date;e.setDate(e.getDate()-7),o=o.filter(a=>new Date(a.lastMessageTime||a.updatedAt)>=e);break}}return o.sort((e,a)=>{const x=new Date(e.lastMessageTime||e.updatedAt),S=new Date(a.lastMessageTime||a.updatedAt);return h.value==="desc"?S-x:x-S}),o}),N=u(()=>R.value.length),M=u(()=>Math.ceil(v.value.length/_.value)),$=u(()=>{const o=(l.value-1)*_.value,e=o+_.value;return v.value.slice(o,e)}),W=o=>o.participantTwoName||o.otherParticipantName||o.participantName||"Unknown User",O=()=>c.value.trim()?"No conversations found":d.value==="unread"?"No unread conversations":d.value==="recent"?"No recent conversations":"No conversations yet",q=()=>c.value.trim()?`No conversations match "${c.value}". Try adjusting your search terms.`:d.value==="unread"?"All your conversations are up to date. Great job staying on top of your messages!":d.value==="recent"?"No conversations have had activity in the last 7 days.":"Start a conversation by finding a lawyer and sending them a message.",G=()=>{b.value&&clearTimeout(b.value),b.value=setTimeout(()=>{l.value=1},300)},H=()=>{c.value="",l.value=1},Q=()=>{l.value=1},Y=()=>{h.value=h.value==="desc"?"asc":"desc",l.value=1},J=()=>{c.value="",d.value="all",h.value="desc",l.value=1},B=o=>{if(o>=1&&o<=M.value){l.value=o;const e=document.querySelector(".conversations-container");e&&e.scrollIntoView({behavior:"smooth",block:"start"})}},K=o=>{console.log("Conversation clicked:",o),r.setCurrentConversation(o),P.push(`/chat/${o.id}`)},C=async()=>{r.clearError(),await r.fetchConversations()},X=async()=>{if(!m.value){m.value=!0,r.clearError();try{await r.fetchConversations()}catch(o){console.error("Retry fetch failed:",o)}finally{m.value=!1}}},Z=async()=>{if(!f.value){f.value=!0;try{await r.manualReconnect()&&await C()}catch(o){console.error("Failed to reconnect WebSocket:",o)}finally{f.value=!1}}},T=o=>{const e=o.detail;console.log("ChatInboxView: Real-time message received:",e),C()},A=o=>{const e=o.detail;console.log("ChatInboxView: Real-time unread count update:",e),C()},L=o=>{const e=o.detail;console.log("ChatInboxView: Real-time read status update:",e),C()},E=o=>{const e=o.detail;console.log("ChatInboxView: WebSocket reconnection status:",e),e.success&&!e.reconnecting&&(console.log("WebSocket reconnected successfully, refreshing chat data..."),C())};return ne(async()=>{!r.isConnected&&U.isLoggedIn&&await r.initialize(),R.value.length===0&&await r.fetchConversations(),window.addEventListener("websocket-message",T),window.addEventListener("websocket-unread-count-update",A),window.addEventListener("websocket-message-read",L),window.addEventListener("websocket-conversation-read",L),window.addEventListener("websocket-reconnection-status",E)}),se(()=>{b.value&&clearTimeout(b.value),window.removeEventListener("websocket-message",T),window.removeEventListener("websocket-unread-count-update",A),window.removeEventListener("websocket-message-read",L),window.removeEventListener("websocket-conversation-read",L),window.removeEventListener("websocket-reconnection-status",E)}),re(v,o=>{const e=Math.ceil(o.length/_.value);l.value>e&&e>0&&(l.value=e)}),(o,e)=>(s(),n("div",de,[t("div",ve,[t("div",we,[t("div",he,[t("div",ke,[e[5]||(e[5]=t("h1",null,"Messages",-1)),t("p",ge,[p(i(N.value)+" conversation"+i(N.value!==1?"s":"")+" ",1),F.value?(s(),n("span",pe," â€¢ "+i(I.value)+" unread ",1)):g("",!0)])]),t("div",me,[j.value?g("",!0):(s(),n("button",{key:0,onClick:Z,class:"btn btn-outline",disabled:f.value},[f.value?(s(),n("svg",Ce,e[7]||(e[7]=[t("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"2",fill:"none",opacity:"0.3"},null,-1),t("path",{d:"M12 2a10 10 0 0 1 10 10",stroke:"currentColor","stroke-width":"2",fill:"none"},null,-1)]))):(s(),n("svg",ye,e[6]||(e[6]=[t("path",{d:"M1 4v6h6M23 20v-6h-6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),t("path",{d:"M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))),p(" "+i(f.value?"Reconnecting...":"Reconnect"),1)],8,fe)),t("button",{onClick:C,class:"btn btn-primary",disabled:y.value},[y.value?(s(),n("svg",_e,e[9]||(e[9]=[t("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"2",fill:"none",opacity:"0.3"},null,-1),t("path",{d:"M12 2a10 10 0 0 1 10 10",stroke:"currentColor","stroke-width":"2",fill:"none"},null,-1)]))):(s(),n("svg",xe,e[8]||(e[8]=[t("path",{d:"M1 4v6h6M23 20v-6h-6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),t("path",{d:"M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))),p(" "+i(y.value?"Refreshing...":"Refresh"),1)],8,be)])]),j.value?g("",!0):(s(),n("div",Me,e[10]||(e[10]=[t("svg",{class:"warning-icon",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),t("span",null,"Disconnected from chat service. Messages may not update in real-time.",-1)]))),t("div",Le,[t("div",Se,[e[12]||(e[12]=t("svg",{class:"search-icon",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("circle",{cx:"11",cy:"11",r:"8",stroke:"currentColor","stroke-width":"2"}),t("path",{d:"M21 21l-4.35-4.35",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),V(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>c.value=a),type:"text",placeholder:"Search conversations...",class:"search-input",onInput:G},null,544),[[ae,c.value]]),c.value?(s(),n("button",{key:0,onClick:H,class:"clear-search-btn","aria-label":"Clear search"},e[11]||(e[11]=[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]))):g("",!0)]),t("div",Re,[V(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>d.value=a),onChange:Q,class:"filter-select"},e[13]||(e[13]=[t("option",{value:"all"},"All conversations",-1),t("option",{value:"unread"},"Unread only",-1),t("option",{value:"recent"},"Recent activity",-1)]),544),[[le,d.value]]),t("button",{onClick:Y,class:"sort-btn",title:h.value==="desc"?"Sort oldest first":"Sort newest first"},[(s(),n("svg",Ne,[e[14]||(e[14]=t("path",{d:"M3 6h18M7 12h10m-7 6h4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)),h.value==="desc"?(s(),n("path",Be)):(s(),n("path",Te))])),p(" "+i(h.value==="desc"?"Newest first":"Oldest first"),1)],8,je)])])]),t("div",Ae,[y.value&&v.value.length===0?(s(),n("div",Ee,[D(ce,{type:"conversation-list",count:5,animated:!0})])):k.value&&v.value.length===0?(s(),n("div",Ve,[e[16]||(e[16]=t("svg",{class:"error-icon",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),e[17]||(e[17]=t("h3",null,"Failed to load conversations",-1)),t("p",null,i(z.value),1),t("button",{onClick:X,class:"btn btn-primary",disabled:m.value},[m.value?(s(),n("svg",Ue,e[15]||(e[15]=[t("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"2",fill:"none",opacity:"0.3"},null,-1),t("path",{d:"M12 2a10 10 0 0 1 10 10",stroke:"currentColor","stroke-width":"2",fill:"none"},null,-1)]))):g("",!0),p(" "+i(m.value?"Retrying...":"Try again"),1)],8,De)])):v.value.length===0&&!y.value?(s(),n("div",Pe,[e[18]||(e[18]=t("svg",{class:"empty-icon",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),t("h3",null,i(O()),1),t("p",null,i(q()),1),t("div",Ie,[t("button",{onClick:e[2]||(e[2]=a=>o.$router.push("/find-lawyer")),class:"btn btn-primary"}," Find a Lawyer "),c.value||d.value!=="all"?(s(),n("button",{key:0,onClick:J,class:"btn btn-outline"}," Clear Filters ")):g("",!0)])])):(s(),n("div",Fe,[D(ue,{conversations:$.value,loading:y.value,onConversationClick:K},null,8,["conversations","loading"]),M.value>1?(s(),n("div",ze,[t("button",{onClick:e[3]||(e[3]=a=>B(l.value-1)),disabled:l.value<=1,class:"pagination-btn"},e[19]||(e[19]=[t("svg",{class:"icon",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("polyline",{points:"15,18 9,12 15,6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),p(" Previous ")]),8,$e),t("div",We,[t("span",Oe," Page "+i(l.value)+" of "+i(M.value),1),t("span",qe,i(v.value.length)+" conversation"+i(v.value.length!==1?"s":""),1)]),t("button",{onClick:e[4]||(e[4]=a=>B(l.value+1)),disabled:l.value>=M.value,class:"pagination-btn"},e[20]||(e[20]=[p(" Next "),t("svg",{class:"icon",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("polyline",{points:"9,18 15,12 9,6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]),8,Ge)])):g("",!0)]))])])]))}},Ke=ee(He,[["__scopeId","data-v-482f68bc"]]);export{Ke as default};
