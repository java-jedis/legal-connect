import{_ as q,u as O,f as p,l as j,A as Q,c as r,b as t,a as S,m as M,i as T,v as G,j as K,s as W,x as X,y as tt,t as i,F as L,r as A,w as et,g as h,z as st,o as l,n as $}from"./index-rvQoOiZL.js";import{a as C}from"./aiChatService-B6U_Tdqr.js";const ot={class:"chat-history-container"},nt={class:"history-header"},at={class:"header-content"},rt={class:"history-actions"},it=["disabled"],lt=["disabled"],ct={class:"main-layout"},dt={class:"history-content"},ut={class:"history-controls"},vt={class:"search-container"},ht={class:"filter-container"},wt={key:0,class:"loading-state"},pt={key:1,class:"no-history-state"},gt={class:"no-history-content"},kt={key:0},mt={key:1},yt={key:2,class:"sessions-container"},ft={class:"sessions-header"},Ct={class:"sessions-count"},_t={class:"sessions-list"},xt={class:"session-header"},bt={class:"session-info"},St={class:"session-title"},Mt={class:"session-summary"},Lt={class:"session-meta"},At={class:"session-date"},Dt={class:"session-stats"},Ht={class:"session-preview"},Vt={key:0,class:"messages-preview"},Bt={class:"preview-avatar"},It={key:0},Ft={key:1,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},jt={class:"preview-content"},Tt={class:"preview-sender"},$t={class:"preview-text"},Nt={class:"session-actions"},Ut=["onClick"],Zt=["onClick"],Et=["onClick"],Yt={class:"modal-header"},Rt={class:"modal-body"},Pt={class:"session-metadata"},zt={class:"metadata-row"},Jt={class:"metadata-row"},qt={class:"metadata-row"},Ot={class:"metadata-row"},Qt={class:"session-messages"},Gt={class:"messages-list"},Kt={class:"message-avatar"},Wt={key:0},Xt={key:1,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},te={class:"message-content"},ee={class:"message-header"},se={class:"message-sender"},oe={class:"message-time"},ne={class:"message-text"},ae={class:"modal-footer"},re={key:1,class:"error-message"},ie={class:"error-content"},le={__name:"ChatHistoryView",setup(ce){const _=st(),v=O(),d=p([]),c=p(null),w=p(!1),u=p(""),g=p(""),k=p("all"),D=j(()=>{var s,e;return(s=v.userInfo)!=null&&s.firstName?v.userInfo.firstName.charAt(0).toUpperCase():(e=v.userInfo)!=null&&e.email?v.userInfo.email.charAt(0).toUpperCase():"U"}),m=j(()=>{let s=[...d.value];if(g.value.trim()){const e=g.value.toLowerCase();s=s.filter(n=>{var o;return b(n).toLowerCase().includes(e)||B(n).toLowerCase().includes(e)||((o=n.messages)==null?void 0:o.some(a=>a.content.toLowerCase().includes(e)))})}if(k.value!=="all"){const e=new Date,n=new Date;switch(k.value){case"today":n.setHours(0,0,0,0);break;case"week":n.setDate(e.getDate()-7);break;case"month":n.setMonth(e.getMonth()-1);break}s=s.filter(o=>new Date(o.lastActivity)>=n)}return s.sort((e,n)=>new Date(n.lastActivity)-new Date(e.lastActivity))}),H=async()=>{w.value=!0,u.value="";try{await N()}catch(s){console.error("Error loading chat history:",s),u.value="Failed to load chat history. Please try again."}finally{w.value=!1}},N=async()=>{var s;try{if((s=v.userInfo)!=null&&s.id)try{const n=await C.getUserSessions(v.userInfo.id,50);if(n.sessions&&n.sessions.length>0){d.value=n.sessions.map(o=>({id:o.id,messages:[],createdAt:new Date(o.created_at),lastActivity:new Date(o.updated_at),messageCount:o.message_count||0,title:o.title||"New Chat Session",isFromBackend:!0,preview:o.preview||null})),await U();return}}catch(n){console.warn("Failed to load sessions from backend, falling back to localStorage:",n)}const e=localStorage.getItem("ai_chat_sessions");e?d.value=JSON.parse(e):d.value=[]}catch(e){console.error("Error loading chat history:",e),u.value="Failed to load chat history. Please try again."}},U=async()=>{const s=d.value.filter(e=>e.isFromBackend&&e.messageCount>0);for(const e of s.slice(0,5))try{const o=(await C.getChatHistory(e.id)).messages||[];o.length>0&&(e.messages=o.slice(0,3).map(a=>({type:a.role==="user"?"user":"ai",content:a.content,timestamp:new Date(a.created_at)})))}catch(n){console.warn(`Failed to load preview for session ${e.id}:`,n)}},Z=async()=>{var s;if(confirm("Are you sure you want to clear all chat history? This action cannot be undone."))try{(s=v.userInfo)!=null&&s.id,d.value=[],localStorage.removeItem("ai_chat_sessions")}catch(e){console.error("Error clearing history:",e),u.value="Failed to clear history. Please try again."}},E=async s=>{if(s.isFromBackend&&(!s.messages||s.messages.length===0))try{const n=(await C.getChatHistory(s.id)).messages||[];s.messages=n.map(o=>({type:o.role==="user"?"user":"ai",content:o.content,timestamp:new Date(o.created_at)}))}catch(e){console.error("Error loading session messages:",e),u.value="Failed to load session details.";return}c.value=s},x=()=>{c.value=null},V=s=>{_.push(`/ai-chat/${s.id}`)},Y=async s=>{var e,n;if(confirm("Are you sure you want to delete this chat session?"))try{(s.isFromBackend||(e=v.userInfo)!=null&&e.id&&s.id.includes("-"))&&await C.deleteSession(s.id),d.value=d.value.filter(o=>o.id!==s.id),localStorage.setItem("ai_chat_sessions",JSON.stringify(d.value.filter(o=>!o.isFromBackend))),((n=c.value)==null?void 0:n.id)===s.id&&(c.value=null)}catch(o){console.error("Error deleting session:",o),u.value="Failed to delete session. Please try again."}},b=s=>{if(s.title&&s.title!=="New Chat Session")return s.title;if(s.messages&&s.messages.length>0){const e=s.messages.find(n=>n.type==="user");if(e)return y(e.content,60)}return s.isFromBackend?"Chat Session":s.id.includes("-")?`Chat ${s.id.split("-")[0]}`:`Chat Session ${s.id.split("_").pop()}`},B=s=>{if(s.messages&&s.messages.length>0){const e=s.messages.slice().reverse().find(o=>o.type==="ai");if(e)return y(e.content,100);const n=s.messages[s.messages.length-1];return y(n.content,100)}return s.isFromBackend?`${s.messageCount||0} messages`:"Empty conversation"},y=(s,e)=>s.length<=e?s:s.substring(0,e)+"...",R=s=>{const e=new Date(s),n=new Date,o=Math.abs(n-e),a=Math.floor(o/(1e3*60*60*24)),f=Math.floor(o/(1e3*60*60)),F=Math.floor(o/(1e3*60));return a===0?f===0?F===0?"Just now":`${F}m ago`:`${f}h ago`:a===1?"Yesterday":a<=7?`${a}d ago`:e.getFullYear()===n.getFullYear()?e.toLocaleDateString("en-US",{month:"short",day:"numeric"}):e.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},I=s=>new Date(s).toLocaleString(),P=s=>new Intl.DateTimeFormat("en-US",{hour:"2-digit",minute:"2-digit"}).format(new Date(s)),z=()=>{_.push("/ai-chat")},J=()=>{_.push("/document-search")};return Q(()=>{H()}),(s,e)=>{const n=tt("router-link");return l(),r("div",ot,[t("div",nt,[t("div",at,[e[7]||(e[7]=S('<div class="history-info" data-v-fac559e0><div class="history-icon" data-v-fac559e0><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-fac559e0><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" data-v-fac559e0></circle><polyline points="12,6 12,12 16,14" stroke="currentColor" stroke-width="2" data-v-fac559e0></polyline></svg></div><div class="history-details" data-v-fac559e0><h1 class="history-title" data-v-fac559e0>Chat History</h1><p class="history-description" data-v-fac559e0>View and manage your AI chat sessions</p></div></div>',1)),t("div",rt,[t("button",{onClick:H,class:"btn-action",title:"Refresh history",disabled:w.value},e[5]||(e[5]=[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("polyline",{points:"23,4 23,10 17,10",stroke:"currentColor","stroke-width":"2"}),t("polyline",{points:"1,20 1,14 7,14",stroke:"currentColor","stroke-width":"2"}),t("path",{d:"M20.49,9A9,9 0 0,0 5.64,5.64L1,10m22,4l-4.64,4.36A9,9 0 0,1 3.51,15",stroke:"currentColor","stroke-width":"2"})],-1)]),8,it),t("button",{onClick:Z,class:"btn-action danger",title:"Clear all history",disabled:w.value||d.value.length===0},e[6]||(e[6]=[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M3 6H5H21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]),8,lt)])])]),t("div",ct,[t("div",dt,[t("div",ut,[t("div",vt,[e[8]||(e[8]=t("svg",{class:"search-icon",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("circle",{cx:"11",cy:"11",r:"8",stroke:"currentColor","stroke-width":"2"}),t("path",{d:"m21 21-4.35-4.35",stroke:"currentColor","stroke-width":"2"})],-1)),T(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>g.value=o),placeholder:"Search chat history...",class:"search-input"},null,512),[[G,g.value]])]),t("div",ht,[T(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>k.value=o),class:"filter-select"},e[9]||(e[9]=[t("option",{value:"all"},"All time",-1),t("option",{value:"today"},"Today",-1),t("option",{value:"week"},"This week",-1),t("option",{value:"month"},"This month",-1)]),512),[[K,k.value]])])]),w.value?(l(),r("div",wt,e[10]||(e[10]=[t("div",{class:"loading-content"},[t("div",{class:"loading-spinner-large"}),t("p",null,"Loading chat history...")],-1)]))):m.value.length===0&&!w.value?(l(),r("div",pt,[t("div",gt,[e[12]||(e[12]=t("svg",{class:"no-history-icon",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M21 11.5C21.0034 12.8199 20.6951 14.1219 20.1 15.3C19.3944 16.7118 18.3098 17.8992 16.9674 18.7293C15.6251 19.5594 14.0782 19.9994 12.5 20C11.1801 20.0035 9.87812 19.6951 8.7 19.1L3 21L4.9 15.3C4.30493 14.1219 3.99656 12.8199 4 11.5C4.00061 9.92179 4.44061 8.37488 5.27072 7.03258C6.10083 5.69028 7.28825 4.60557 8.7 3.9C9.87812 3.30493 11.1801 2.99656 12.5 3H13C15.0843 3.11499 17.053 3.99476 18.5291 5.47086C20.0052 6.94696 20.885 8.91565 21 11V11.5Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("line",{x1:"15",y1:"9",x2:"9",y2:"15",stroke:"currentColor","stroke-width":"2"}),t("line",{x1:"9",y1:"9",x2:"15",y2:"15",stroke:"currentColor","stroke-width":"2"})],-1)),e[13]||(e[13]=t("h3",null,"No chat history found",-1)),g.value?(l(),r("p",kt,"Try adjusting your search or filter criteria")):(l(),r("p",mt,"Start a conversation with the AI assistant to see your chat history here")),W(n,{to:"/ai-chat",class:"btn"},{default:X(()=>e[11]||(e[11]=[h("Start New Chat")])),_:1,__:[11]})])])):(l(),r("div",yt,[t("div",ft,[e[14]||(e[14]=t("h2",null,"Chat Sessions",-1)),t("span",Ct,i(m.value.length)+" session"+i(m.value.length!==1?"s":""),1)]),t("div",_t,[(l(!0),r(L,null,A(m.value,o=>(l(),r("div",{key:o.id,class:"session-item"},[t("div",xt,[t("div",bt,[t("h3",St,i(b(o)),1),t("p",Mt,i(B(o)),1)]),t("div",Lt,[t("span",At,i(R(o.lastActivity)),1),t("span",Dt,i(o.messageCount)+" messages",1)])]),t("div",Ht,[o.messages&&o.messages.length>0?(l(),r("div",Vt,[(l(!0),r(L,null,A(o.messages.slice(-2),(a,f)=>(l(),r("div",{key:f,class:$(["preview-message",`preview-message--${a.type}`])},[t("div",Bt,[a.type==="user"?(l(),r("span",It,i(D.value),1)):(l(),r("svg",Ft,e[15]||(e[15]=[t("path",{d:"M12 2L2 7L12 12L22 7L12 2Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),t("path",{d:"M2 17L12 22L22 17",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),t("path",{d:"M2 12L12 17L22 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])))]),t("div",jt,[t("span",Tt,i(a.type==="user"?"You":"AI"),1),t("p",$t,i(y(a.content,100)),1)])],2))),128))])):M("",!0)]),t("div",Nt,[t("button",{onClick:a=>E(o),class:"action-button primary",title:"View session"},e[16]||(e[16]=[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z",stroke:"currentColor","stroke-width":"2"}),t("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor","stroke-width":"2"})],-1),h(" View ")]),8,Ut),t("button",{onClick:a=>V(o),class:"action-button",title:"Continue session"},e[17]||(e[17]=[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M21 11.5C21.0034 12.8199 20.6951 14.1219 20.1 15.3C19.3944 16.7118 18.3098 17.8992 16.9674 18.7293C15.6251 19.5594 14.0782 19.9994 12.5 20C11.1801 20.0035 9.87812 19.6951 8.7 19.1L3 21L4.9 15.3C4.30493 14.1219 3.99656 12.8199 4 11.5C4.00061 9.92179 4.44061 8.37488 5.27072 7.03258C6.10083 5.69028 7.28825 4.60557 8.7 3.9C9.87812 3.30493 11.1801 2.99656 12.5 3H13C15.0843 3.11499 17.053 3.99476 18.5291 5.47086C20.0052 6.94696 20.885 8.91565 21 11V11.5Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),h(" Continue ")]),8,Zt),t("button",{onClick:a=>Y(o),class:"action-button danger",title:"Delete session"},e[18]||(e[18]=[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M3 6H5H21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),h(" Delete ")]),8,Et)])]))),128))])]))]),c.value?(l(),r("div",{key:0,class:"modal-overlay",onClick:x},[t("div",{class:"modal-content",onClick:e[3]||(e[3]=et(()=>{},["stop"]))},[t("div",Yt,[t("h2",null,i(b(c.value)),1),t("button",{onClick:x,class:"modal-close"},"×")]),t("div",Rt,[t("div",Pt,[t("div",zt,[e[19]||(e[19]=t("strong",null,"Session ID:",-1)),h(" "+i(c.value.id),1)]),t("div",Jt,[e[20]||(e[20]=t("strong",null,"Created:",-1)),h(" "+i(I(c.value.createdAt)),1)]),t("div",qt,[e[21]||(e[21]=t("strong",null,"Last Activity:",-1)),h(" "+i(I(c.value.lastActivity)),1)]),t("div",Ot,[e[22]||(e[22]=t("strong",null,"Messages:",-1)),h(" "+i(c.value.messageCount),1)])]),t("div",Qt,[e[24]||(e[24]=t("h3",null,"Messages:",-1)),t("div",Gt,[(l(!0),r(L,null,A(c.value.messages,(o,a)=>(l(),r("div",{key:a,class:$(["message-item",`message-item--${o.type}`])},[t("div",Kt,[o.type==="user"?(l(),r("span",Wt,i(D.value),1)):(l(),r("svg",Xt,e[23]||(e[23]=[t("path",{d:"M12 2L2 7L12 12L22 7L12 2Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),t("path",{d:"M2 17L12 22L22 17",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),t("path",{d:"M2 12L12 17L22 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])))]),t("div",te,[t("div",ee,[t("span",se,i(o.type==="user"?"You":"AI Assistant"),1),t("span",oe,i(P(o.timestamp)),1)]),t("p",ne,i(o.content),1)])],2))),128))])])]),t("div",ae,[t("button",{onClick:e[2]||(e[2]=o=>V(c.value)),class:"btn btn-secondary"}," Continue Chat "),t("button",{onClick:x,class:"btn"},"Close")])])])):M("",!0),u.value?(l(),r("div",re,[t("div",ie,[e[25]||(e[25]=t("svg",{class:"error-icon",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"2"}),t("line",{x1:"15",y1:"9",x2:"9",y2:"15",stroke:"currentColor","stroke-width":"2"}),t("line",{x1:"9",y1:"9",x2:"15",y2:"15",stroke:"currentColor","stroke-width":"2"})],-1)),t("span",null,i(u.value),1),t("button",{onClick:e[4]||(e[4]=o=>u.value=""),class:"error-close"},"×")])])):M("",!0),t("div",{class:"right-actions-sidebar"},[e[28]||(e[28]=t("div",{class:"actions-header"},[t("h4",null,"Quick Actions")],-1)),t("div",{class:"action-buttons"},[t("button",{onClick:z,class:"action-btn ai-chat-btn",title:"AI Legal Assistant"},e[26]||(e[26]=[S('<div class="action-icon" data-v-fac559e0><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-fac559e0><path d="M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-fac559e0></path><circle cx="12" cy="10" r="1.5" fill="currentColor" data-v-fac559e0></circle><circle cx="8" cy="10" r="1.5" fill="currentColor" data-v-fac559e0></circle><circle cx="16" cy="10" r="1.5" fill="currentColor" data-v-fac559e0></circle></svg></div><div class="action-text" data-v-fac559e0><span class="action-title" data-v-fac559e0>AI Chat</span><span class="action-subtitle" data-v-fac559e0>Ask legal questions to AI</span></div>',2)])),t("button",{onClick:J,class:"action-btn document-search-btn",title:"Search Legal Documents"},e[27]||(e[27]=[S('<div class="action-icon" data-v-fac559e0><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-fac559e0><path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-fac559e0></path><polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-fac559e0></polyline><circle cx="11.5" cy="12.5" r="2.5" stroke="currentColor" stroke-width="2" data-v-fac559e0></circle><path d="m13.5 14.5 1.5 1.5" stroke="currentColor" stroke-width="2" data-v-fac559e0></path></svg></div><div class="action-text" data-v-fac559e0><span class="action-title" data-v-fac559e0>Search Documents</span><span class="action-subtitle" data-v-fac559e0>Browse legal documents and laws</span></div>',2)]))])])])])}}},he=q(le,[["__scopeId","data-v-fac559e0"]]);export{he as default};
