import{N as A,f as d,l as z,u as E,a2 as v}from"./index-rvQoOiZL.js";const J=A("blog",()=>{const i=d([]),B=d({page:0,size:10,total:0,totalPages:0,sortDirection:"DESC"}),g=d(!1),c=d(null),b=d(null),m=d([]),w=d({page:0,size:10,total:0,totalPages:0}),p=d([]),S=d({page:0,size:10,total:0,totalPages:0,sortDirection:"DESC"}),y=d([]),P=d({page:0,size:10,total:0,totalPages:0}),C=z(()=>{var a;return(((a=i.value)==null?void 0:a.length)||0)>0}),D=z(()=>{var a;return(((a=p.value)==null?void 0:a.length)||0)>0});return{blogs:i,pagination:B,isLoading:g,error:c,currentBlog:b,subscribers:m,subscriberPage:w,subscribedBlogs:p,subscribedBlogsPage:S,searchResults:y,searchPage:P,hasBlogs:C,hasSubscribedBlogs:D,loadMyBlogs:async(a=0,r=10,l="DESC")=>{var s,e,u,o;g.value=!0,c.value=null;try{const n=(s=E().getUserInfo())==null?void 0:s.id;if(!n)throw new Error("Not authenticated");const f=await v.getAuthorBlogs(n,a,r,l);i.value=((e=f.data)==null?void 0:e.blogs)||[];const h=f.metadata||{};return B.value={page:h.pageNumber??a,size:h.pageSize??r,total:h.totalCount??i.value.length,totalPages:h.totalPages??1,sortDirection:h.sortDirection??l},i.value}catch(t){throw console.error("Error loading blogs:",t),c.value=((o=(u=t.response)==null?void 0:u.data)==null?void 0:o.message)||t.message||"Failed to load blogs",t}finally{g.value=!1}},createBlog:async({title:a,content:r,status:l})=>{var s,e,u;g.value=!0,c.value=null;try{const o={title:a,content:r,status:l},n=(await v.createBlog(o)).data;return i.value=[n,...i.value],n}catch(o){throw c.value=((u=(e=(s=o.response)==null?void 0:s.data)==null?void 0:e.error)==null?void 0:u.message)||o.message||"Failed to create blog",o}finally{g.value=!1}},updateBlog:async(a,{title:r,content:l,status:s})=>{var e,u,o,t;g.value=!0,c.value=null;try{const n={title:r,content:l,status:s},h=(await v.updateBlog(a,n)).data;return i.value=i.value.map(F=>F.blogId===a?h:F),((e=b.value)==null?void 0:e.blogId)===a&&(b.value=h),h}catch(n){throw c.value=((t=(o=(u=n.response)==null?void 0:u.data)==null?void 0:o.error)==null?void 0:t.message)||n.message||"Failed to update blog",n}finally{g.value=!1}},deleteBlog:async a=>{var r,l,s,e;g.value=!0,c.value=null;try{return await v.deleteBlog(a),i.value=i.value.filter(u=>u.blogId!==a),((r=b.value)==null?void 0:r.blogId)===a&&(b.value=null),!0}catch(u){throw c.value=((e=(s=(l=u.response)==null?void 0:l.data)==null?void 0:s.error)==null?void 0:e.message)||u.message||"Failed to delete blog",u}finally{g.value=!1}},changeStatus:async(a,r)=>{var l,s,e,u;g.value=!0,c.value=null;try{const t=(await v.changeBlogStatus(a,r)).data;return i.value=i.value.map(n=>n.blogId===a?t:n),((l=b.value)==null?void 0:l.blogId)===a&&(b.value=t),t}catch(o){throw c.value=((u=(e=(s=o.response)==null?void 0:s.data)==null?void 0:e.error)==null?void 0:u.message)||o.message||"Failed to update status",o}finally{g.value=!1}},loadSubscribers:async(a=0,r=10)=>{var l,s,e,u;g.value=!0,c.value=null;try{const o=await v.getSubscribers(a,r);m.value=((l=o.data)==null?void 0:l.subscribers)||[];const t=o.metadata||{};return w.value={page:t.pageNumber??a,size:t.pageSize??r,total:t.totalCount??m.value.length,totalPages:t.totalPages??1},m.value}catch(o){throw c.value=((u=(e=(s=o.response)==null?void 0:s.data)==null?void 0:e.error)==null?void 0:u.message)||o.message||"Failed to load subscribers",o}finally{g.value=!1}},getBlogById:async a=>{var r,l,s;g.value=!0,c.value=null;try{const e=await v.getBlog(a);return b.value=e.data,b.value}catch(e){throw c.value=((s=(l=(r=e.response)==null?void 0:r.data)==null?void 0:l.error)==null?void 0:s.message)||e.message||"Failed to load blog",e}finally{g.value=!1}},loadSubscribedBlogs:async(a=0,r=10,l="DESC")=>{var s,e,u,o;g.value=!0,c.value=null;try{const t=await v.getSubscribedBlogs(a,r,l);p.value=((s=t.data)==null?void 0:s.blogs)||[];const n=t.metadata||{};return S.value={page:n.pageNumber??a,size:n.pageSize??r,total:n.totalCount??p.value.length,totalPages:n.totalPages??1,sortDirection:n.sortDirection??l},p.value}catch(t){throw c.value=((o=(u=(e=t.response)==null?void 0:e.data)==null?void 0:u.error)==null?void 0:o.message)||t.message||"Failed to load subscribed blogs",t}finally{g.value=!1}},subscribeToAuthor:async a=>{var r,l,s;try{return await v.subscribe(a)}catch(e){throw c.value=((s=(l=(r=e.response)==null?void 0:r.data)==null?void 0:l.error)==null?void 0:s.message)||e.message||"Failed to subscribe",e}},unsubscribeFromAuthor:async a=>{var r,l,s;try{return await v.unsubscribe(a)}catch(e){throw c.value=((s=(l=(r=e.response)==null?void 0:r.data)==null?void 0:l.error)==null?void 0:s.message)||e.message||"Failed to unsubscribe",e}},searchPublishedBlogs:async(a,r=0,l=10)=>{var s,e,u,o;g.value=!0,c.value=null;try{const t=await v.searchPublished(a,r,l);y.value=((s=t.data)==null?void 0:s.results)||[];const n=t.metadata||{};return P.value={page:n.pageNumber??r,size:n.pageSize??l,total:n.totalCount??y.value.length,totalPages:n.totalPages??1},y.value}catch(t){throw c.value=((o=(u=(e=t.response)==null?void 0:e.data)==null?void 0:u.error)==null?void 0:o.message)||t.message||"Failed to search blogs",t}finally{g.value=!1}},reset:()=>{i.value=[],m.value=[],p.value=[],y.value=[],b.value=null,c.value=null}}});export{J as u};
